name: Deployment

on:
  release:
    types: [ published ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  deploy-mac:
    runs-on: macos-latest

    steps:
      - name: Checkout source code repo
        uses: actions/checkout@v2.4.2
        with:
          repository: muselive-inc/muselive-studio-v2
          ref: develop
          token: ${{ secrets.GH_TOKEN }}
  
      - name: Setup Node.js environment
        uses: actions/setup-node@v3.3.0
        with:
          node-version: 17
          cache: yarn
      
      - name: Setup Python
        uses: actions/setup-python@v4.0.0
        with:
          python-version: 3.7
  
      - name: Install Dependencies
        run: |
          yarn
          cd audio_process
          pip install -U pip
          pip install -r requirements-dev.txt
      
      - name: "Import Certificate: Developer ID"
        uses: devbotsxyz/import-signing-certificate@v1.0.0
        with:
          certificate-data: ${{ secrets.CERTIFICATES_P12 }}
          certificate-passphrase: ${{ secrets.CERTIFICATES_P12_PASSWORD }}
          keychain-password: ${{ secrets.CERTIFICATES_P12_PASSWORD }}
  
      - name: Build Artifacts
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          yarn build:back
          yarn build:front
          yarn package:mac
  
